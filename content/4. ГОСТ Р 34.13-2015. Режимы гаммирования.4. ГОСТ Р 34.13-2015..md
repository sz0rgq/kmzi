## Введение
ГОСТ Р 34.13-2015 определяет режимы работы блочных шифров, включая **режимы гаммирования**, которые позволяют преобразовывать блочный шифр в потоковый. Эти режимы улучшают свойства шифрования, делая его стойким к анализу структуры данных.

Основные режимы гаммирования:
1. **CTR (Counter Mode, Счетчик)**
2. **OFB (Output Feedback, Режим вывода обратной связи)**

Эти режимы широко используются в криптографии для обеспечения конфиденциальности данных.

---

## Режим CTR (счетчик)

Режим **CTR (Counter Mode, Счетчик)** позволяет шифровать данные поблочно, но при этом делает процесс независимым для каждого блока.
### **Алгоритм работы**
1. Выбирается **начальный вектор (IV)**, который должен быть уникальным для каждого сообщения.
2. Для каждого блока данных вычисляется **значение счетчика**:
$$ C_i = \text{E}(K, \text{IV} + i) \oplus P_i $$
   - $C_i$ — зашифрованный блок.
   - $P_i$ — открытый текст.
   - $\text{E}(K, X)$ — блочный шифр (например, ГОСТ Р 34.12-2015).
   - $\text{IV}$ — начальный вектор.
   - $i$ — номер блока.
3. Расшифрование выполняется аналогично:
  $$ P_i = \text{E}(K, \text{IV} + i) \oplus C_i $$

### **Преимущества**
- Параллельная обработка блоков (ускоряет работу).  
- Не накапливает ошибки.  
- Позволяет случайный доступ к данным.  

### **Недостатки**
- Требует уникальности $\text{IV}$ для каждого сообщения.  
- Уязвим к атаке на повторное использование счетчика.  

---

## Режим OFB (вывод обратной связи)

Режим **OFB (Output Feedback)** превращает блочный шифр в потоковый, генерируя гамму на основе предыдущих выходов.
### **Алгоритм работы**
1. Выбирается начальный вектор $IV$.
2. Вычисляется последовательность гаммы:
   $$ S_0 = IV $$
   $$ S_i = \text{E}(K, S_{i-1}) $$
3. Шифрование:
   $$ C_i = P_i \oplus S_i $$
4. Расшифрование:
   $$ P_i = C_i \oplus S_i $$

### **Преимущества**
- Защищает от подстановки блоков.  
- Не зависит от порядка обработки данных.  
### **Недостатки**
- Неустойчив к изменению битов в шифротексте (ошибка распространяется).  
- Гамма зависит от $IV$, который должен быть уникальным.  

---

## Сравнение режимов

| Режим  | Параллельность | Устойчивость к ошибкам | Требования к IV |
|--------|--------------|-----------------|-------------|
| **CTR** | Да        | Ошибки не влияют | Уникальный IV |
| **OFB** | Нет       | Ошибки распространяются | Уникальный IV |

---

## Безопасность и применение
- Оба режима используются в **VPN**, **шифровании дисков**, **TLS**.
- **CTR** предпочтителен для высокой производительности.
- **OFB** используется в потоковом шифровании, но менее надежен при изменениях данных.

---

