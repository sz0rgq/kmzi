## Введение
Шифр «Кузнечик» — это современный российский блочный шифр, утверждённый в ГОСТ Р 34.12-2015. В отличие от «Магмы», он использует **128-битные блоки** и поддерживает **длины ключей 128 и 256 бит**. Алгоритм построен по принципу **SP-сети** (Substitution-Permutation Network), что обеспечивает высокую стойкость к современным атакам.

---

## Основные параметры
| Параметр       | Значение                     |
|----------------|------------------------------|
| Размер блока   | 128 бит                      |
| Длина ключа    | 128 или 256 бит              |
| Число раундов  | 10 (для 256-битного ключа)   |
| Структура      | SP-сеть                      |

---

## Алгоритм шифрования
### 1. Разбиение данных
- Входной блок данных $T$ делится на 16 байт: $T = t_1 \| t_2 \| \dots \| t_{16}$.
### 2. Раундовые преобразования
Каждый раунд состоит из трёх операций:
1. **XOR с раундовым ключом** ($K_i$):
   $$ X = T \oplus K_i $$
2. **Нелинейное преобразование (S-блоки)**:
   - Каждый байт $x_j$ заменяется через S-блок $\pi$:
   $$ y_j = \pi(x_j), \quad j = 1..16 $$
3. **Линейное преобразование (L-слой)**:
   - 16 байт $Y = (y_1, \dots, y_{16})$ преобразуются в $Z = L(Y)$ по формуле:  $$ z_j = \bigoplus_{k=0}^{15} l_{j,k} \cdot y_{k+1} $$
   - Здесь $l_{j,k}$ — коэффициенты из матрицы линейного преобразования.
### 3. Финальный раунд
После 10 раундов выполняется последний XOR с ключом $K_{11}$:
$$ C = Z \oplus K_{11} $$

---

## Генерация раундовых ключей
1. **Исходный ключ** $K$ (256 бит) делится на 2 части:
   - $K_1 = k_1 \| \dots \| k_{16}$ (первые 128 бит)
   - $K_2 = k_{17} \| \dots \| k_{32}$ (вторые 128 бит)

2. **Итеративное вычисление**:
   - Для $i = 1..10$:
     $$ K_{i+1} = L(\pi(K_i \oplus C_i)) \oplus K_{i-1} $$
   - Здесь $C_i$ — константы раундов, а $K_0 = K_2$.

---

## Режимы работы (ГОСТ Р 34.13-2015)
Как и у «Магмы», поддерживаются 4 режима:
1. **Простая замена (ECB)**  
   *Недостаток*: Уязвим к анализу паттернов.
2. **Гаммирование (CTR)**  
   $$ C_i = P_i \oplus E(K, IV + i) $$

3. **Гаммирование с обратной связью (CFB)**  
   $$ C_i = P_i \oplus E(K, C_{i-1}) $$
4. **Выработка имитовставки (MAC)**  
   - Используется для аутентификации сообщений.

---
## Безопасность и криптоанализ
- **Стойкость**: 10 раундов обеспечивают защиту от дифференциального и линейного криптоанализа.
- **Атаки**:
  - Для 128-битного ключа возможны атаки с сложностью $2^{126}$ операций (теоретически).
  - Для 256-битного ключа атаки пока неэффективны.

**Преимущества перед «Магмой»**:
- Больший размер блока (128 бит vs 64 бит) → выше устойчивость к атакам.
- SP-сеть лучше защищает от современных методов криптоанализа.

---
## Пример работы (упрощённый)
1. **Входной блок**: $P = \text{0x11223344556677889900AABBCCDDEEFF}$
2. **Ключ**: 256-битный $K = \text{0x...}$ (32 байта)
3. **Шаги**:
   - Разделить $P$ на 16 байт.
   - Применить 10 раундов преобразований.
   - Получить шифротекст $C$.

---
## Сравнение с AES
| Параметр       | Кузнечик           | AES-256            |
|----------------|--------------------|--------------------|
| **Длина блока**| 128 бит            | 128 бит            |
| **Ключ**       | 128/256 бит        | 128/192/256 бит    |
| **Раунды**     | 10                 | 14                 |
| **Структура**  | SP-сеть            | SP-сеть            |

---
## Применение
- Защита данных в системах государственного назначения (ФСБ, банки).
- Используется в российских криптографических библиотеках (например, CryptoPro).

---
