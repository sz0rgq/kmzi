## Введение
ГОСТ Р 34.12-2015 — российский стандарт, определяющий алгоритмы блочного шифрования. Шифр «Магма» (известный также как **GOST 28147-89** после модернизации) — симметричный блочный шифр с длиной блока **64 бита** и ключом **256 бит**. 
**Применение**: Защита данных в госструктурах и коммерческих системах, требующих соответствия российским стандартам.
---

## Структура шифра
### Основные параметры
| Параметр      | Значение           |
| ------------- | ------------------ |
| Размер блока  | 64 бита            |
| Длина ключа   | 256 бит (32 байта) |
| Число раундов | 32                 |
| Структура     | Сеть Фейстеля      |

### Алгоритм шифрования
1. **Разбиение блока**:
   - Исходный блок делится на две части по 32 бита: $L_0$ и $R_0$.

2. **Раундовое преобразование** (32 раунда):
   - Для каждого раунда $i = 1..32$:  
   $$L_i = R_{i-1}, \\R_i = L_{i-1} \oplus f(R_{i-1}, K_i),$$   где:
     - $K_i$ — подключ раунда (вычисляется из основного ключа),
     - $f$ — функция раунда.

3. **Функция раунда $f$**:
   - **Сложение с подключом**: $R_{i-1} + K_i \mod 2^{32}$.
   - **Разбиение на 8 частей** по 4 бита → замена через S-блоки (8 шт., каждый 4→4 бита).
   - **Циклический сдвиг влево** на 11 бит.

4. **Финальное преобразование**:
   - После 32 раундов $L_{32}$ и $R_{32}$ объединяются в шифротекст.
---

## Генерация подключей
- Ключ $K$ (256 бит) делится на **8 подключей** по 32 бита: $K_1, K_2, \dots, K_8$.
- Для раундов 1–24: подключи используются в порядке $K_1, K_2, \dots, K_8, K_1, K_2, \dots$.
- Для раундов 25–32: в обратном порядке $K_8, K_7, \dots, K_1$.
---

## Режимы работы
Стандарт поддерживает 4 режима (определены в ГОСТ Р 34.13-2015):
1. **Простая замена** (аналог ECB):
   - Каждый блок шифруется независимо.  
   *Уязвимость*: Повторяющиеся блоки дают одинаковый шифротекст.

2. **Гаммирование** (аналог CTR):
   - Шифрование с использованием гаммы (псевдослучайной последовательности).  
   *Формула*: $C_i = P_i \oplus E(K, IV + i)$, где $IV$ — синхропосылка.

3. **Гаммирование с обратной связью** (аналог CFB):
   - Шифротекст зависит от предыдущих блоков.

4. **Выработка имитовставки** (аналог MAC):
   - Генерация аутентификационного кода для проверки целостности.
---

## S-блоки
- **Особенность**: Стандарт не фиксирует S-блоки — они определяются пользователем.  
- **Пример S-блока** (4 бита → 4 бита):
Вход: 0 1 2 3 4 5 6 7 8 9 A B C D E F  
Выход: 4 2 F 6 7 8 0 5 9 C D E A B 1 3

---

## Безопасность и криптоанализ
- **Стойкость**: Обеспечивается 32 раундами, нелинейностью S-блоков и длиной ключа 256 бит.
- **Атаки**:
- **Дифференциальный криптоанализ**: Эффективен только при слабых S-блоках.
- **Полный перебор**: Практически невозможен ($2^{256}$ вариантов ключей).

**Уязвимости**:
- Режим простой замены (ECB) не скрывает паттерны данных.
- Требуется тщательный выбор S-блоков для избежания слабых ключей.

---

## Пример шифрования (упрощенный)
1. **Исходный блок**: $P = \text{0x0123456789ABCDEF}$.
2. **Ключ**: $K = \text{0xFFEEDDCCBBAA99887766554433221100}$.
3. **Шаги**:
 - Разделить $P$ на $L_0 = \text{0x01234567}$, $R_0 = \text{0x89ABCDEF}$.
 - Вычислить $f(R_0, K_1)$, где $K_1 = \text{0xFFEEDDCC}$.
 - Получить $L_1 = R_0$, $R_1 = L_0 \oplus f(R_0, K_1)$.
 - Повторить для всех 32 раундов.

---

## Сравнение с «Кузнечиком»
| Параметр       | Магма               | Кузнечик            |
|----------------|---------------------|---------------------|
| **Длина блока**| 64 бита             | 128 бит             |
| **Ключ**       | 256 бит             | 256 бит             |
| **Раунды**     | 32                  | 10                  |
| **Структура**  | Сеть Фейстеля       | SP-сеть             |

---

## Применение
- Банковские системы (например, СБПС).
- Защита данных в госструктурах РФ.
- Встроенная поддержка в криптобиблиотеках (например, OpenSSL с патчами ГОСТ).

---
